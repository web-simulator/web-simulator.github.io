(function(){"use strict";const P={endo:{u_o:0,u_u:1.56,theta_v:.3,theta_w:.13,theta_vminus:.2,theta_o:.006,tau_v1minus:75,tau_v2minus:10,tau_vplus:1.4506,tau_w1minus:6,tau_w2minus:140,k_wminus:200,u_wminus:.016,tau_wplus:280,tau_fi:.15,tau_o1:470,tau_o2:6,tau_so1:40,tau_so2:1.2,k_so:2,u_so:.65,tau_s1:2.7342,tau_s2:2,k_s:2.0994,u_s:.9087,tau_si:2.9013,tau_winf:.0273,w_infstar:.78},myo:{u_o:0,u_u:1.61,theta_v:.3,theta_w:.13,theta_vminus:.1,theta_o:.005,tau_v1minus:80,tau_v2minus:1.4506,tau_vplus:1.4506,tau_w1minus:70,tau_w2minus:8,k_wminus:200,u_wminus:.016,tau_wplus:280,tau_fi:.117,tau_o1:410,tau_o2:7,tau_so1:91,tau_so2:.8,k_so:2.1,u_so:.6,tau_s1:2.7342,tau_s2:4,k_s:2.0994,u_s:.9087,tau_si:3.3849,tau_winf:.01,w_infstar:.5},epi:{u_o:0,u_u:1.55,theta_v:.3,theta_w:.13,theta_vminus:.006,theta_o:.006,tau_v1minus:60,tau_v2minus:1150,tau_vplus:1.4506,tau_w1minus:60,tau_w2minus:15,k_wminus:65,u_wminus:.03,tau_wplus:200,tau_fi:.165,tau_o1:400,tau_o2:6,tau_so1:30.0181,tau_so2:.9957,k_so:2.0458,u_so:.65,tau_s1:2.7342,tau_s2:16,k_s:2.0994,u_s:.9087,tau_si:1.8875,tau_winf:.07,w_infstar:.94}};self.onmessage=j=>{const q=j.data,{protocol:_,dt:a,cellType:g,minimalCellParams:M,downsamplingFactor:z,inicio:u,duração:l,amplitude:m,tempo_total:G,BCL:J,num_estimulos:b,BCL_S1:w,intervalo_S2:y,num_estimulos_s1:S}=q;let x;M&&M[g]?x=M[g]:x=P[g]||P.epi;const{u_o:K,u_u:N,theta_v:C,theta_w:A,theta_vminus:B,theta_o:O,tau_v1minus:Q,tau_v2minus:U,tau_vplus:V,tau_w1minus:D,tau_w2minus:W,k_wminus:X,u_wminus:Y,tau_wplus:Z,tau_fi:$,tau_o1:tt,tau_o2:st,tau_so1:F,tau_so2:ut,k_so:_t,u_so:at,tau_s1:it,tau_s2:ot,k_s:nt,u_s:et,tau_si:lt,tau_winf:mt,w_infstar:wt}=x;let f=0;_==="single"?f=G:_==="multiple"?f=u+b*J+200:_==="s1s2"&&(f=u+(S-1)*w+y+2*w);const ft=parseInt(f/a,10),E=[];let t=0,c=1,h=1,v=0,s=0;for(let p=0;p<ft;p++){s=p*a;let n=0;if(_==="single")s>=u&&s<u+l&&(n=m);else if(_==="multiple")for(let i=0;i<b;i++){const o=u+i*J;if(s>=o&&s<o+l){n=m;break}}else if(_==="s1s2"){for(let o=0;o<S;o++){const T=u+o*w;if(s>=T&&s<T+l){n=m;break}}const i=u+(S-1)*w+y;s>=i&&s<i+l&&(n=m)}const ct=t-C>0?1:0,e=t-A>0?1:0,I=t-B>0?1:0,r=t-O>0?1:0,ht=(1-I)*Q+I*U,vt=D+(W-D)*(1+Math.tanh(X*(t-Y)))*.5,pt=F+(ut-F)*(1+Math.tanh(_t*(t-at)))*.5,rt=(1-e)*it+e*ot,kt=(1-r)*tt+r*st,dt=-c*ct*(t-C)*(N-t)/$,gt=(t-K)*(1-e)/kt+e/pt,Mt=-e*h*v/lt,St=-(dt+gt+Mt)+n;t=t+St*a;const xt=t<B?1:0;let H,k;t>=C?(H=V,k=0):(H=ht,k=xt),c=k+(c-k)*Math.exp(-a/H);const Ct=(1-r)*(1-t/mt)+r*wt;let L,d;t>=A?(L=Z,d=0):(L=vt,d=Ct),h=d+(h-d)*Math.exp(-a/L);const R=(1+Math.tanh(nt*(t-et)))*.5;v=R+(v-R)*Math.exp(-a/rt),p%z===0&&E.push({tempo:s.toFixed(2),v:t,gate_v:c,gate_w:h,gate_s:v})}self.postMessage(E)}})();
