(function(){"use strict";self.onmessage=w=>{const F=w.data;let{k:p,Tau_in:b,Tau_out:y,Tau_open:A,Tau_close:J,gate:L,L:k,dx:e,dt:c,totalTime:z,downsamplingFactor:B,inicio:C,duracao:D,amplitude:E,posição_do_estímulo:N,tamanho_do_estímulo:P,num_estimulos:j,BCL:q}=F;const d=e*e/(2*p);c>d&&(c=d*.9);const l=Math.floor(k/e);let s=new Array(l).fill(0),a=new Array(l).fill(1);function G(i,_,r,m,t,o){for(let n=0;n<o;n++){const u=m+n*t;if(i>=u&&i<u+r)return _}return 0}const H=Math.floor(z/c),x=[],M=Math.floor(N/e),v=Math.floor(P/(2*e)),I=Math.max(1,M-v),K=Math.min(l-2,M+v);for(let i=0;i<H;i++){const _=G(i*c,E,D,C,q,j),r=[...s],m=[...a];for(let t=1;t<l-1;t++){const o=r[t],n=m[t];let u,f;o<L?(u=1/A,f=0):(u=0,f=1/J);const h=u+f;if(h>0){const g=u/h,U=Math.exp(-h*c);a[t]=g+(n-g)*U}const O=p*(r[t+1]-2*o+r[t-1])/(e*e),Q=n*o**2*(1-o)/b,R=-o/y,S=Q+R;let T=0;t>=I&&t<=K&&(T=_),s[t]=o+(O+S+T)*c,s[t]=Math.max(0,Math.min(1,s[t])),a[t]=Math.max(0,Math.min(1,a[t]))}if(s[0]=s[1],s[l-1]=s[l-2],a[0]=a[1],a[l-1]=a[l-2],i%B===0){const t=s.map((o,n)=>({x:n*e,v:o,h:a[n],tempo:(i*c).toFixed(2)}));x.push({time:(i*c).toFixed(2),data:t})}}self.postMessage(x)}})();
